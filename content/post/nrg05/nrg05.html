---
title: "Analyzing Data from Within-Subjects Designs: Multivariate Approach vs. Linear Mixed Models Approach"
output: 
  html_document: 
    theme: readable
---



<div id="within-subjects-design" class="section level1">
<h1>Within-Subjects Design</h1>
<blockquote>
<p>In a within-subjects design, subjects give responses across multiple conditions or across time. In other words, measures are repeated across levels of some condition or across time points. For example, subjects can report how happy they feel when they see a sequence of positive pictures and another sequence of negative pictures. In this case, we’d observe each subjects’ happiness in both positive and negative conditions. As another example, we could measure subjects’ job satisifcation every month for 3 months. Here we’d observe job satisfaction for each subject across time. In both cases, subject scores across conditions or time very likely correlate with eachother – they are dependent.</p>
</blockquote>
</div>
<div id="what-are-contrasts" class="section level1">
<h1>What are contrasts?</h1>
<blockquote>
<p>Broadly, contrasts test focused research hypotheses. A contrast comprises a set of weights or numeric values that represent some comparison. For example, when comparing two experimental group means (i.e., control vs. treatment), you can apply weights to each group mean and then sum them up. This is the same thing as subtracting one group’s mean from the other’s.</p>
</blockquote>
<div id="heres-a-quick-demonstration" class="section level2">
<h2>Here’s a quick demonstration</h2>
<pre class="r"><code># group means
control &lt;- 5
treatment &lt;- 3

# apply contrast weights and sum up the results
sum(c(control, treatment) * c(1, -1))</code></pre>
<pre><code>## [1] 2</code></pre>
</div>
</div>
<div id="model-and-conceptual-assumptions-for-linear-regression" class="section level1">
<h1>Model and Conceptual Assumptions for Linear Regression</h1>
<blockquote>
<ul>
<li><strong>Correct functional form.</strong> Your model variables share linear relationships.<br />
</li>
<li><strong>No omitted influences.</strong> This one is hard: Your model accounts for all relevant influences on the variables included. All models are wrong, but how wrong is yours?<br />
</li>
<li><strong>Accurate measurement.</strong> Your measurements are valid and reliable. Note that unreliable measures can’t be valid, and reliable measures don’t necessairly measure just one construct or even your construct.<br />
</li>
<li><strong>Well-behaved residuals.</strong> Residuals (i.e., prediction errors) aren’t correlated with predictor variables, predicted values, or eachother, and residuals have constant variance across values of your predictor variables or predicted values.</li>
</ul>
</blockquote>
</div>
<div id="model-and-conceptual-assumptions-for-repeated-measures-anova" class="section level1">
<h1>Model and Conceptual Assumptions for Repeated Measures ANOVA</h1>
<blockquote>
<ul>
<li><strong>All change scores variances are equal.</strong> Similar to the homogenous group variance assumption in between-subjects ANOVA designs, within-subjects designs require that all change score variances (e.g., subject changes between time points, within-subject differences between conditions) are equal. This means that if you compute the within-subject differences between all pairiwse levels (e.g., timepoints, treatment levels), the variances of those parwises differences must all be equal. For example, if you ask people how satisifed they are with their current job every month for 3 months, then the variance of month 2 - month 1 should equal the variance of month 3 - month 2 and the variance of month 3 - month 1. As you might be thinking, this assumption is very strict and probably not realistic in many cases.</li>
</ul>
</blockquote>
</div>
<div id="a-different-take-on-the-homogenous-change-score-variance-assumption" class="section level1">
<h1>A different take on the homogenous change score variance assumption</h1>
<blockquote>
<ul>
<li><strong>Sphericity and a special case, compound symmetry.</strong> Sphericity is the matrix algebra equivalent to the homogenous change score variance assumption. Compound symmtry is a special case of sphericity. A variance-covariance matrix that satisifies compound symmetry has equal variances (the values in the diagonal) and equal covariances (the values above or below the diagonal).<br />
<strong>Short explanation</strong>: Sphericity = homogenous change score variance = compound symmetry</li>
</ul>
</blockquote>
</div>
<div id="install-and-load-packages" class="section level1">
<h1>Install and load packages</h1>
<pre class="r"><code># install.packages(&quot;tidyverse&quot;)
# install.packages(&quot;knitr&quot;)
# install.packages(&quot;lattice&quot;)
# install.packages(&quot;AMCP&quot;)
# install.packages(&quot;lme4&quot;)
# install.packages(&quot;lmerTest&quot;)

library(tidyverse)
library(knitr)
library(lattice)
library(AMCP)
library(lme4)
library(lmerTest)</code></pre>
<div id="print-an-example-of-a-matrix-that-satisfies-compound-symmetry" class="section level2">
<h2>Print an example of a matrix that satisfies compound symmetry</h2>
<pre class="r"><code># 3 x 3 matrix, all values = 0.20
covmat &lt;- matrix(0, nrow = 3, ncol = 3)

# for kicks, make all the variances = 0.50
diag(covmat) &lt;- rep(0.50, 3)

# print
covmat %&gt;% 
  as_tibble() %&gt;% 
  mutate(x = factor(colnames(.), levels = colnames(.), ordered = TRUE)) %&gt;% 
  gather(key = y, value = value, -x) %&gt;% 
  mutate(y = factor(y, levels = unique(y), ordered = TRUE)) %&gt;% 
  filter(!is.na(value)) %&gt;% 
  ggplot(mapping = aes(x = x, y = y, fill = value, label = round(value, 2))) +
  geom_tile(color = &quot;black&quot;) +
  geom_text() +
  scale_fill_gradient2(low = &quot;#E41A1C&quot;, mid = &quot;white&quot;, high = &quot;#377EB8&quot;) +
  theme_bw()</code></pre>
<pre><code>## Warning: `as_tibble.matrix()` requires a matrix with column names or a `.name_repair` argument. Using compatibility `.name_repair`.
## This warning is displayed once per session.</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
</div>
<div id="multivariate-approach" class="section level1">
<h1>Multivariate approach</h1>
<blockquote>
<p>placeholder</p>
</blockquote>
</div>
<div id="linear-mixed-models-approach" class="section level1">
<h1>Linear Mixed Models Approach</h1>
<blockquote>
<p>placeholder</p>
</blockquote>
</div>
<div id="save-custom-oneway-function" class="section level1">
<h1>Save custom oneway function</h1>
<pre class="r"><code>oneway &lt;- function(dv, group, contrast, alpha = .05) {
  # -- arguments --
  # dv: vector of measurements (i.e., dependent variable)
  # group: vector that identifies which group the dv measurement came from
  # contrast: list of named contrasts
  # alpha: alpha level for 1 - alpha confidence level
  # -- output --
  # computes confidence interval and test statistic for a linear contrast of population means in a between-subjects design
  # returns a data.frame object
  # estimate (est), standard error (se), t-statistic (z), degrees of freedom (df), two-tailed p-value (p), and lower (lwr) and upper (upr) confidence limits at requested 1 - alpha confidence level
  # first line reports test statistics that assume variances are equal
  # second line reports test statistics that do not assume variances are equal
  
  # means, standard deviations, and sample sizes
  ms &lt;- by(dv, group, mean, na.rm = TRUE)
  vars &lt;- by(dv, group, var, na.rm = TRUE)
  ns &lt;- by(dv, group, function(x) sum(!is.na(x)))
  
  # convert list of contrasts to a matrix of named contrasts by row
  contrast &lt;- matrix(unlist(contrast), nrow = length(contrast), byrow = TRUE, dimnames = list(names(contrast), NULL))
  
  # contrast estimate
  est &lt;- contrast %*% ms
  
  # welch test statistic
  se_welch &lt;- sqrt(contrast^2 %*% (vars / ns))
  t_welch &lt;- est / se_welch
  
  # classic test statistic
  mse &lt;- anova(lm(dv ~ factor(group)))$&quot;Mean Sq&quot;[2]
  se_classic &lt;- sqrt(mse * (contrast^2 %*% (1 / ns)))
  t_classic &lt;- est / se_classic
  
  # if dimensions of contrast are NULL, nummer of contrasts = 1, if not, nummer of contrasts = dimensions of contrast
  num_contrast &lt;- ifelse(is.null(dim(contrast)), 1, dim(contrast)[1])
  df_welch &lt;- rep(0, num_contrast)
  df_classic &lt;- rep(0, num_contrast)
  
  # makes rows of contrasts if contrast dimensions aren&#39;t NULL
  if(is.null(dim(contrast))) contrast &lt;- t(as.matrix(contrast))
  
  # calculating degrees of freedom for welch and classic
  for(i in 1:num_contrast) {
    df_classic[i] &lt;- sum(ns) - length(ns)
    df_welch[i] &lt;- sum(contrast[i, ]^2 * vars / ns)^2 / sum((contrast[i, ]^2 * vars / ns)^2 / (ns - 1))
  }
  
  # p-values
  p_welch &lt;- 2 * (1 - pt(abs(t_welch), df_welch))
  p_classic &lt;- 2 * (1 - pt(abs(t_classic), df_classic))
  
  # 95% confidence intervals
  lwr_welch &lt;- est - se_welch * qt(p = 1 - (alpha / 2), df = df_welch)
  upr_welch &lt;- est + se_welch * qt(p = 1 - (alpha / 2), df = df_welch)
  lwr_classic &lt;- est - se_classic * qt(p = 1 - (alpha / 2), df = df_classic)
  upr_classic &lt;- est + se_classic * qt(p = 1 - (alpha / 2), df = df_classic)
  
  # output
  data.frame(contrast = rep(rownames(contrast), times = 2),
             equal_var = rep(c(&quot;Assumed&quot;, &quot;Not Assumed&quot;), each = num_contrast),
             est = rep(est, times = 2),
             se = c(se_classic, se_welch),
             t = c(t_classic, t_welch),
             df = c(df_classic, df_welch),
             p = c(p_classic, p_welch),
             lwr = c(lwr_classic, lwr_welch),
             upr = c(upr_classic, upr_welch))
}</code></pre>
</div>
<div id="heres-a-simple-demonstration-using-two-responses-from-the-same-participants" class="section level1">
<h1>Here’s a simple demonstration using two responses from the same participants</h1>
<div id="load-data" class="section level2">
<h2>Load data</h2>
<blockquote>
<p>From <code>help(&quot;sleep&quot;)</code>: “Data which show the effect of two soporific drugs (increase in hours of sleep compared to control) on 10 patients.”</p>
</blockquote>
<pre class="r"><code># create label
sleep$group_lbl &lt;- with(sleep, ifelse(group == 1, &quot;drug 1 vs. control&quot;, &quot;drug 2 vs. control&quot;))

# &quot;The group variable name may be misleading about the data: They represent measurements on 10 persons, not in groups.&quot;
kable(sleep)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">extra</th>
<th align="left">group</th>
<th align="left">ID</th>
<th align="left">group_lbl</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.7</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="even">
<td align="right">-1.6</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="odd">
<td align="right">-0.2</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="even">
<td align="right">-1.2</td>
<td align="left">1</td>
<td align="left">4</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="odd">
<td align="right">-0.1</td>
<td align="left">1</td>
<td align="left">5</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="even">
<td align="right">3.4</td>
<td align="left">1</td>
<td align="left">6</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="odd">
<td align="right">3.7</td>
<td align="left">1</td>
<td align="left">7</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="even">
<td align="right">0.8</td>
<td align="left">1</td>
<td align="left">8</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="odd">
<td align="right">0.0</td>
<td align="left">1</td>
<td align="left">9</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="even">
<td align="right">2.0</td>
<td align="left">1</td>
<td align="left">10</td>
<td align="left">drug 1 vs. control</td>
</tr>
<tr class="odd">
<td align="right">1.9</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">drug 2 vs. control</td>
</tr>
<tr class="even">
<td align="right">0.8</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">drug 2 vs. control</td>
</tr>
<tr class="odd">
<td align="right">1.1</td>
<td align="left">2</td>
<td align="left">3</td>
<td align="left">drug 2 vs. control</td>
</tr>
<tr class="even">
<td align="right">0.1</td>
<td align="left">2</td>
<td align="left">4</td>
<td align="left">drug 2 vs. control</td>
</tr>
<tr class="odd">
<td align="right">-0.1</td>
<td align="left">2</td>
<td align="left">5</td>
<td align="left">drug 2 vs. control</td>
</tr>
<tr class="even">
<td align="right">4.4</td>
<td align="left">2</td>
<td align="left">6</td>
<td align="left">drug 2 vs. control</td>
</tr>
<tr class="odd">
<td align="right">5.5</td>
<td align="left">2</td>
<td align="left">7</td>
<td align="left">drug 2 vs. control</td>
</tr>
<tr class="even">
<td align="right">1.6</td>
<td align="left">2</td>
<td align="left">8</td>
<td align="left">drug 2 vs. control</td>
</tr>
<tr class="odd">
<td align="right">4.6</td>
<td align="left">2</td>
<td align="left">9</td>
<td align="left">drug 2 vs. control</td>
</tr>
<tr class="even">
<td align="right">3.4</td>
<td align="left">2</td>
<td align="left">10</td>
<td align="left">drug 2 vs. control</td>
</tr>
</tbody>
</table>
</div>
<div id="visualize-relationships" class="section level2">
<h2>Visualize relationships</h2>
<blockquote>
<p>It’s always a good idea to look at your data. Check some assumptions.</p>
</blockquote>
<pre class="r"><code>ggplot(sleep, mapping = aes(x = group_lbl, y = extra, color = group_lbl)) +
  geom_violin(alpha = 0) +
  geom_boxplot(outlier.color = NA, width = 0.25) +
  geom_point(position = position_jitter(width = 0.10), alpha = 0.50) +
  theme_bw()</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="test-within-subjects-effect-using-different-approaches" class="section level2">
<h2>Test within-subjects effect using different approaches</h2>
<div id="using-t.testpaired-true" class="section level3">
<h3>using <code>t.test(paired = TRUE)</code></h3>
<pre class="r"><code>t.test(extra ~ group, data = sleep, paired = TRUE)</code></pre>
<pre><code>## 
##  Paired t-test
## 
## data:  extra by group
## t = -4.0621, df = 9, p-value = 0.002833
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -2.4598858 -0.7001142
## sample estimates:
## mean of the differences 
##                   -1.58</code></pre>
</div>
<div id="compute-a-difference-score-and-test-whether-the-mean-difference-0" class="section level3">
<h3>Compute a difference score and test whether the mean difference = 0</h3>
<pre class="r"><code># using dotproduct
t.test(with(sleep, cbind(extra[group == 1], extra[group == 2]) %*% c(-1, 1)))</code></pre>
<pre><code>## 
##  One Sample t-test
## 
## data:  with(sleep, cbind(extra[group == 1], extra[group == 2]) %*% c(-1,     1))
## t = 4.0621, df = 9, p-value = 0.002833
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  0.7001142 2.4598858
## sample estimates:
## mean of x 
##      1.58</code></pre>
<pre class="r"><code># subtracting group 1 from group 2
t.test(with(sleep, extra[group == 1] * -1 + extra[group == 2] * 1))</code></pre>
<pre><code>## 
##  One Sample t-test
## 
## data:  with(sleep, extra[group == 1] * -1 + extra[group == 2] * 1)
## t = 4.0621, df = 9, p-value = 0.002833
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  0.7001142 2.4598858
## sample estimates:
## mean of x 
##      1.58</code></pre>
</div>
<div id="fit-a-linear-mixed-effects-model" class="section level3">
<h3>Fit a linear mixed effects model</h3>
<pre class="r"><code># create new contrast code called drug, which represents the drug effect on sleep increase
sleep$drug &lt;- with(sleep, ifelse(group == 1, -0.5, 0.5))

# fit model
lmer1 &lt;- lmer(extra ~ drug + (1 | ID), data = sleep, REML = TRUE)

# diagnostics
plot(lmer1)</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>qqmath(ranef(lmer1, condVar = TRUE))</code></pre>
<pre><code>## $ID</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<pre class="r"><code>qqmath(lmer1)</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<pre class="r"><code>dotplot(ranef(lmer1, condVar = TRUE))</code></pre>
<pre><code>## $ID</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-9-4.png" width="672" /></p>
<pre class="r"><code># results
summary(lmer1)</code></pre>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: extra ~ drug + (1 | ID)
##    Data: sleep
## 
## REML criterion at convergence: 70
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.63372 -0.34157  0.03346  0.31511  1.83859 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  ID       (Intercept) 2.8483   1.6877  
##  Residual             0.7564   0.8697  
## Number of obs: 20, groups:  ID, 10
## 
## Fixed effects:
##             Estimate Std. Error    df t value Pr(&gt;|t|)   
## (Intercept)    1.540      0.568 9.000   2.711  0.02395 * 
## drug           1.580      0.389 9.000   4.062  0.00283 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##      (Intr)
## drug 0.000</code></pre>
</div>
</div>
</div>
<div id="heres-a-more-complex-situation-with-an-additional-between-subjects-factor" class="section level1">
<h1>Here’s a more complex situation with an additional between-subjects factor</h1>
<div id="generate-data" class="section level2">
<h2>Generate data</h2>
<pre class="r"><code># set random seed
set.seed(8888)

# id
id &lt;- 1:50

# two treatment conditions, each size = 25
treatment &lt;- rep(1:2, each = 25)

# labels in a separate column
treatment_lbl &lt;- ifelse(treatment == 1, &quot;control&quot;, &quot;treatment&quot;)

# draws random numbers from true populations, depending on treatment value
response1 &lt;- rnorm(n = rep(25, 2)[treatment], mean = c(4, 5)[treatment], sd = c(1, 1)[treatment])

# response 2 should be correlated r = 0.5 with response 1, but the mean should be slightly higher
response2 &lt;- response1 * 0.5 + rnorm(n = 50, mean = c(1, 2)[treatment], sd = 1)

# save and print data
mydata &lt;- tibble(id, treatment_lbl, treatment, response1, response2)
kable(mydata)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="left">treatment_lbl</th>
<th align="right">treatment</th>
<th align="right">response1</th>
<th align="right">response2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">4.195752</td>
<td align="right">4.1745159</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">4.976012</td>
<td align="right">1.7597310</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.963119</td>
<td align="right">4.6346111</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.975639</td>
<td align="right">3.3488885</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">4.022112</td>
<td align="right">4.2694685</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.291423</td>
<td align="right">1.8133618</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.074208</td>
<td align="right">3.2192163</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">5.453050</td>
<td align="right">3.8107214</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.843103</td>
<td align="right">1.3888784</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.562954</td>
<td align="right">2.4298635</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.482628</td>
<td align="right">4.3645302</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.608857</td>
<td align="right">3.4381481</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.360039</td>
<td align="right">0.2610100</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">4.099164</td>
<td align="right">5.8771612</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">4.088679</td>
<td align="right">2.9806595</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">5.063440</td>
<td align="right">2.4306743</td>
</tr>
<tr class="odd">
<td align="right">17</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">4.361441</td>
<td align="right">2.4265752</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.022724</td>
<td align="right">0.3446552</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">4.879871</td>
<td align="right">3.0962526</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">4.260023</td>
<td align="right">2.5881955</td>
</tr>
<tr class="odd">
<td align="right">21</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.201820</td>
<td align="right">2.0445063</td>
</tr>
<tr class="even">
<td align="right">22</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">5.360563</td>
<td align="right">3.6988670</td>
</tr>
<tr class="odd">
<td align="right">23</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">3.087335</td>
<td align="right">2.3934641</td>
</tr>
<tr class="even">
<td align="right">24</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">4.780342</td>
<td align="right">3.9045912</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="left">control</td>
<td align="right">1</td>
<td align="right">5.244337</td>
<td align="right">3.8680810</td>
</tr>
<tr class="even">
<td align="right">26</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">4.427888</td>
<td align="right">4.4144632</td>
</tr>
<tr class="odd">
<td align="right">27</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">3.382405</td>
<td align="right">4.4673716</td>
</tr>
<tr class="even">
<td align="right">28</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">4.974487</td>
<td align="right">2.7394246</td>
</tr>
<tr class="odd">
<td align="right">29</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">3.258423</td>
<td align="right">3.7922637</td>
</tr>
<tr class="even">
<td align="right">30</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">4.931010</td>
<td align="right">4.3812514</td>
</tr>
<tr class="odd">
<td align="right">31</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">5.809873</td>
<td align="right">4.7746719</td>
</tr>
<tr class="even">
<td align="right">32</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">4.712183</td>
<td align="right">5.0906109</td>
</tr>
<tr class="odd">
<td align="right">33</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">5.443887</td>
<td align="right">5.3443579</td>
</tr>
<tr class="even">
<td align="right">34</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">4.851525</td>
<td align="right">2.5236780</td>
</tr>
<tr class="odd">
<td align="right">35</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">6.003865</td>
<td align="right">3.1215988</td>
</tr>
<tr class="even">
<td align="right">36</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">6.023490</td>
<td align="right">5.8752659</td>
</tr>
<tr class="odd">
<td align="right">37</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">6.516993</td>
<td align="right">7.1395760</td>
</tr>
<tr class="even">
<td align="right">38</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">6.122140</td>
<td align="right">5.2266728</td>
</tr>
<tr class="odd">
<td align="right">39</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">5.639430</td>
<td align="right">4.5648023</td>
</tr>
<tr class="even">
<td align="right">40</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">6.431992</td>
<td align="right">5.2331465</td>
</tr>
<tr class="odd">
<td align="right">41</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">3.166982</td>
<td align="right">5.1602065</td>
</tr>
<tr class="even">
<td align="right">42</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">5.618815</td>
<td align="right">5.5389033</td>
</tr>
<tr class="odd">
<td align="right">43</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">4.846700</td>
<td align="right">4.6647061</td>
</tr>
<tr class="even">
<td align="right">44</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">3.910692</td>
<td align="right">5.3452577</td>
</tr>
<tr class="odd">
<td align="right">45</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">5.993828</td>
<td align="right">4.8716862</td>
</tr>
<tr class="even">
<td align="right">46</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">3.465042</td>
<td align="right">2.9443906</td>
</tr>
<tr class="odd">
<td align="right">47</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">5.742368</td>
<td align="right">4.3487534</td>
</tr>
<tr class="even">
<td align="right">48</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">3.460245</td>
<td align="right">4.3271617</td>
</tr>
<tr class="odd">
<td align="right">49</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">3.854740</td>
<td align="right">4.8651375</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="left">treatment</td>
<td align="right">2</td>
<td align="right">4.719107</td>
<td align="right">6.0689389</td>
</tr>
</tbody>
</table>
<pre class="r"><code># restructure
lmydata &lt;- gather(mydata, key = sequence_lbl, value = response, response1:response2) %&gt;% 
  mutate(sequence = ifelse(sequence_lbl == &quot;response1&quot;, -0.5, 0.5),
         treatment = ifelse(treatment == 1, -0.5, 0.5))</code></pre>
</div>
<div id="visualize-relationships-1" class="section level2">
<h2>Visualize relationships</h2>
<blockquote>
<p>It’s always a good idea to look at your data. Check some assumptions.</p>
</blockquote>
<pre class="r"><code>ggplot(lmydata, mapping = aes(x = sequence_lbl, y = response, color = treatment_lbl)) +
  geom_violin(position = position_dodge(width = 0.90), alpha = 0) +
  geom_boxplot(outlier.color = NA, width = 0.25, position = position_dodge(width = 0.90)) +
  geom_point(position = position_jitterdodge(dodge.width = 0.90, jitter.width = 0.10), alpha = 0.40) +
  theme_bw()</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="test-effects-using-different-approaches" class="section level2">
<h2>Test effects using different approaches</h2>
<div id="test-average-treatment-effect-between-subjects" class="section level3">
<h3>Test average treatment effect (between-subjects)</h3>
<pre class="r"><code># create new columns that averages the responses
mydata$response_avg &lt;- with(mydata, (response1 + response2) / 2)

# using t.test
t.test(response_avg ~ treatment_lbl, data = mydata)</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  response_avg by treatment_lbl
## t = -5.1627, df = 47.999, p-value = 4.622e-06
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.7592474 -0.7730385
## sample estimates:
##   mean in group control mean in group treatment 
##                3.536505                4.802648</code></pre>
<pre class="r"><code># using oneway function
oneway(dv = mydata$response_avg, group = mydata$treatment_lbl, contrast = list(treatment_lbl = c(-1, 1)), alpha = 0.05)</code></pre>
<pre><code>##        contrast   equal_var      est       se        t       df
## 1 treatment_lbl     Assumed 1.266143 0.245248 5.162703 48.00000
## 2 treatment_lbl Not Assumed 1.266143 0.245248 5.162703 47.99921
##              p       lwr      upr
## 1 4.621802e-06 0.7730387 1.759247
## 2 4.621969e-06 0.7730385 1.759247</code></pre>
<pre class="r"><code># using oneway function and dotproduct
oneway(dv = as.numeric(as.matrix(mydata[, c(&quot;response1&quot;, &quot;response2&quot;)]) %*% c(1, 1) / 2), group = mydata$treatment_lbl, contrast = list(treatment_lbl = c(-1, 1)), alpha = 0.05)</code></pre>
<pre><code>##        contrast   equal_var      est       se        t       df
## 1 treatment_lbl     Assumed 1.266143 0.245248 5.162703 48.00000
## 2 treatment_lbl Not Assumed 1.266143 0.245248 5.162703 47.99921
##              p       lwr      upr
## 1 4.621802e-06 0.7730387 1.759247
## 2 4.621969e-06 0.7730385 1.759247</code></pre>
</div>
<div id="test-sequence-effect-within-subjects-via-multivariate-approach" class="section level3">
<h3>Test sequence effect (within-subjects) via multivariate approach</h3>
<blockquote>
<p>Average sequence effect will differ depending on whether other terms are included in the model</p>
</blockquote>
<pre class="r"><code># create new columns that reflects difference between two response
mydata$response_diff &lt;- with(mydata, -response1 + response2)

# using t.test on difference score, compare to mean = 0
with(mydata, t.test(response_diff))</code></pre>
<pre><code>## 
##  One Sample t-test
## 
## data:  response_diff
## t = -3.6779, df = 49, p-value = 0.000584
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  -1.0569850 -0.3100477
## sample estimates:
##  mean of x 
## -0.6835164</code></pre>
<pre class="r"><code># using paired t.test
t.test(response ~ sequence_lbl, data = lmydata, paired = TRUE)</code></pre>
<pre><code>## 
##  Paired t-test
## 
## data:  response by sequence_lbl
## t = 3.6779, df = 49, p-value = 0.000584
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  0.3100477 1.0569850
## sample estimates:
## mean of the differences 
##               0.6835164</code></pre>
<pre class="r"><code># using oneway function
oneway(dv = mydata$response_diff, group = mydata$treatment_lbl, contrast = list(treatment_lbl = c(1, 1) / 2), alpha = 0.05)</code></pre>
<pre><code>##        contrast   equal_var        est        se         t       df
## 1 treatment_lbl     Assumed -0.6835164 0.1775092 -3.850597 48.00000
## 2 treatment_lbl Not Assumed -0.6835164 0.1775092 -3.850597 47.97627
##              p       lwr        upr
## 1 0.0003484712 -1.040423 -0.3266102
## 2 0.0003486282 -1.040427 -0.3266056</code></pre>
<pre class="r"><code># using oneway function and dotproduct
oneway(dv = as.numeric(as.matrix(mydata[, c(&quot;response1&quot;, &quot;response2&quot;)]) %*% c(-1, 1)), group = mydata$treatment_lbl, contrast = list(treatment_lbl = c(1, 1) / 2), alpha = 0.05)</code></pre>
<pre><code>##        contrast   equal_var        est        se         t       df
## 1 treatment_lbl     Assumed -0.6835164 0.1775092 -3.850597 48.00000
## 2 treatment_lbl Not Assumed -0.6835164 0.1775092 -3.850597 47.97627
##              p       lwr        upr
## 1 0.0003484712 -1.040423 -0.3266102
## 2 0.0003486282 -1.040427 -0.3266056</code></pre>
</div>
<div id="test-treatment-by-sequence-effect-via-multivariate-approach" class="section level3">
<h3>Test treatment by sequence effect via multivariate approach</h3>
<pre class="r"><code># using independent samples welch t.test
t.test(response_diff ~ treatment_lbl, data = mydata)</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  response_diff by treatment_lbl
## t = -2.3895, df = 47.976, p-value = 0.02085
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.5621492 -0.1345063
## sample estimates:
##   mean in group control mean in group treatment 
##              -1.1076802              -0.2593525</code></pre>
<pre class="r"><code># using oneway function
oneway(dv = mydata$response_diff, group = mydata$treatment_lbl, contrast = list(treatment_lbl = c(-1, 1)), alpha = 0.05)</code></pre>
<pre><code>##        contrast   equal_var       est        se        t       df
## 1 treatment_lbl     Assumed 0.8483278 0.3550184 2.389532 48.00000
## 2 treatment_lbl Not Assumed 0.8483278 0.3550184 2.389532 47.97627
##            p       lwr      upr
## 1 0.02084609 0.1345154 1.562140
## 2 0.02084812 0.1345063 1.562149</code></pre>
<pre class="r"><code># using oneway function and dotproduct
oneway(dv = as.numeric(as.matrix(mydata[, c(&quot;response1&quot;, &quot;response2&quot;)]) %*% c(-1, 1)), group = mydata$treatment_lbl, contrast = list(treatment_lbl = c(-1, 1)), alpha = 0.05)</code></pre>
<pre><code>##        contrast   equal_var       est        se        t       df
## 1 treatment_lbl     Assumed 0.8483278 0.3550184 2.389532 48.00000
## 2 treatment_lbl Not Assumed 0.8483278 0.3550184 2.389532 47.97627
##            p       lwr      upr
## 1 0.02084609 0.1345154 1.562140
## 2 0.02084812 0.1345063 1.562149</code></pre>
</div>
<div id="test-treatment-by-sequence-effect-via-linear-mixed-effects-model" class="section level3">
<h3>Test treatment by sequence effect via linear mixed effects model</h3>
<pre class="r"><code># fit model
lmer2 &lt;- lmer(response ~ treatment * sequence + (1 + sequence | id), data = lmydata, REML = TRUE, control = lmerControl(check.nobs.vs.nlev = &quot;ignore&quot;, check.nobs.vs.nRE = &quot;ignore&quot;))</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : unable to evaluate scaled gradient</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge: degenerate Hessian with 1
## negative eigenvalues</code></pre>
<pre><code>## Warning: Model failed to converge with 1 negative eigenvalue: -1.9e-03</code></pre>
<pre class="r"><code># diagnostics
plot(lmer2)</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>qqmath(ranef(lmer2, condVar = TRUE))</code></pre>
<pre><code>## $id</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<pre class="r"><code>qqmath(lmer2)</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-15-3.png" width="672" /></p>
<pre class="r"><code>dotplot(ranef(lmer2, condVar = TRUE))</code></pre>
<pre><code>## $id</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-15-4.png" width="672" /></p>
<pre class="r"><code># results
summary(lmer2)</code></pre>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: response ~ treatment * sequence + (1 + sequence | id)
##    Data: lmydata
## Control: 
## lmerControl(check.nobs.vs.nlev = &quot;ignore&quot;, check.nobs.vs.nRE = &quot;ignore&quot;)
## 
## REML criterion at convergence: 290.1
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.71150 -0.45806 -0.00089  0.43872  1.58043 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  id       (Intercept) 0.5068   0.7119       
##           sequence    0.5947   0.7711   0.52
##  Residual             0.4903   0.7002       
## Number of obs: 100, groups:  id, 50
## 
## Fixed effects:
##                    Estimate Std. Error      df t value Pr(&gt;|t|)    
## (Intercept)          4.1696     0.1226 47.9928  34.001  &lt; 2e-16 ***
## treatment            1.2661     0.2453 47.9928   5.162 4.63e-06 ***
## sequence            -0.6835     0.1775 48.0030  -3.851 0.000348 ***
## treatment:sequence   0.8483     0.3550 48.0030   2.390 0.020839 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) trtmnt sequnc
## treatment   0.000               
## sequence    0.261  0.000        
## trtmnt:sqnc 0.000  0.261  0.000 
## convergence code: 0
## unable to evaluate scaled gradient
## Model failed to converge: degenerate  Hessian with 1 negative eigenvalues</code></pre>
</div>
</div>
</div>
<div id="heres-an-example-from-the-maxwell-dalaney-and-kelley-2017-textbook" class="section level1">
<h1>Here’s an example from the Maxwell, Dalaney, and Kelley (2017) textbook</h1>
<div id="load-data-1" class="section level2">
<h2>Load data</h2>
<blockquote>
<p>From <code>help(&quot;C14T8&quot;)</code>: “For the hypothetical data contained in Table 14.8, a perceptual psychologist is interested in age differences (”young&quot; and “old”) in reaction time on a perceptual task. In addition, the psychologist is also interested in the effect of angle (zero degrees off center and eight degrees off center). The question of interest is to see if there are is a main effect of age, a main effect of angle, and an interaction between the two. Table 14.8 presents the same data that we analyzed in chapter 12 for 10 young participants and 10 old participants, except that for the moment we are only analyzing data from the 0 degree and 8 degree conditions of the angle factor.&quot;</p>
</blockquote>
<pre class="r"><code>data(&quot;C14T8&quot;)</code></pre>
<div id="add-angle4" class="section level3">
<h3>Add angle4</h3>
<pre class="r"><code># there is a slight difference between the textbook data and the data available in the package -- I fix that here
C14T8 &lt;- C14T8 %&gt;%
  mutate(subj = 1:20,
         Angle4 = c(510, 480, 630, 660, 660, 450, 600, 660, 660, 540, 570, 720, 540, 660, 570, 780, 690, 570, 750, 690),
         age = recode(Group, `1` = -0.5, `2` = 0.5),
         age_lbl = recode(Group, `1` = &quot;young&quot;, `2` = &quot;old&quot;)) %&gt;% 
  select(subj, Group, age, age_lbl, Angle0, Angle4, Angle8)

# print
kable(C14T8)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">subj</th>
<th align="right">Group</th>
<th align="right">age</th>
<th align="left">age_lbl</th>
<th align="right">Angle0</th>
<th align="right">Angle4</th>
<th align="right">Angle8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">450</td>
<td align="right">510</td>
<td align="right">630</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">390</td>
<td align="right">480</td>
<td align="right">540</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">570</td>
<td align="right">630</td>
<td align="right">660</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">450</td>
<td align="right">660</td>
<td align="right">720</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">510</td>
<td align="right">660</td>
<td align="right">630</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">360</td>
<td align="right">450</td>
<td align="right">450</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">510</td>
<td align="right">600</td>
<td align="right">720</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">510</td>
<td align="right">660</td>
<td align="right">780</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">510</td>
<td align="right">660</td>
<td align="right">660</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">1</td>
<td align="right">-0.5</td>
<td align="left">young</td>
<td align="right">510</td>
<td align="right">540</td>
<td align="right">660</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">420</td>
<td align="right">570</td>
<td align="right">690</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">600</td>
<td align="right">720</td>
<td align="right">810</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">450</td>
<td align="right">540</td>
<td align="right">690</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">630</td>
<td align="right">660</td>
<td align="right">780</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">420</td>
<td align="right">570</td>
<td align="right">780</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">600</td>
<td align="right">780</td>
<td align="right">870</td>
</tr>
<tr class="odd">
<td align="right">17</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">630</td>
<td align="right">690</td>
<td align="right">870</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">480</td>
<td align="right">570</td>
<td align="right">720</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">690</td>
<td align="right">750</td>
<td align="right">900</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="left">old</td>
<td align="right">510</td>
<td align="right">690</td>
<td align="right">810</td>
</tr>
</tbody>
</table>
</div>
<div id="restructure-data" class="section level3">
<h3>Restructure data</h3>
<pre class="r"><code>lC14T8 &lt;- C14T8 %&gt;%
  gather(key = angle, value = rt, Angle0, Angle4, Angle8) %&gt;%
  mutate(angle_num = str_sub(angle, start = nchar(angle), end = nchar(angle)) %&gt;% as.numeric(),
         angle_lbl = recode(angle_num, `0` = &quot;0 degrees&quot;, `4` = &quot;4 degrees&quot;, `8` = &quot;8 degrees&quot;),
         angle_linear = recode(angle_num, `0` = -0.5, `4` = 0, `8` = 0.5),
         angle_quadratic = recode(angle_num, `0` = 0.5, `4` = -1, `8` = 0.5))</code></pre>
</div>
<div id="visualize-relationships-2" class="section level3">
<h3>Visualize relationships</h3>
<blockquote>
<p>It’s always a good idea to look at your data. Check some assumptions.</p>
</blockquote>
<pre class="r"><code>ggplot(lC14T8, mapping = aes(x = angle_lbl, y = rt, color = age_lbl)) +
  geom_violin(position = position_dodge(width = 0.90), alpha = 0) +
  geom_boxplot(outlier.color = NA, width = 0.25, position = position_dodge(width = 0.90)) +
  geom_point(position = position_jitterdodge(dodge.width = 0.90, jitter.width = 0.10), alpha = 0.40) +
  theme_bw()</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
</div>
<div id="test-effects-using-different-approaches-1" class="section level2">
<h2>Test effects using different approaches</h2>
<div id="test-age-effect-between-subjects-via-multivariate-approach" class="section level3">
<h3>Test age effect (between-subjects) via multivariate approach</h3>
<pre class="r"><code># c(1, 2, 3) %*% c(-1, 0, 1) means tke the dot product of the matrix c(1, 2, 3) and the matrix c(-1, 0, 1)
# this means multiply 1 by -1, 2 by 0, and 3 by 1, and add up those products
oneway(dv = as.numeric(as.matrix(C14T8[, c(&quot;Angle0&quot;, &quot;Angle4&quot;, &quot;Angle8&quot;)]) %*% (c(1, 1, 1) / 3)), group = C14T8$Group, contrast = list(age = c(-1, 1)))</code></pre>
<pre><code>##   contrast   equal_var est       se        t       df          p      lwr
## 1      age     Assumed  94 34.84888 2.697361 18.00000 0.01473401 20.78522
## 2      age Not Assumed  94 34.84888 2.697361 17.78843 0.01483957 20.72275
##        upr
## 1 167.2148
## 2 167.2772</code></pre>
</div>
<div id="test-angle-linear-effect-within-subjects" class="section level3">
<h3>Test angle linear effect (within-subjects)</h3>
<pre class="r"><code># c(1, 2, 3) %*% c(-1, 0, 1) means tke the dot product of the matrix c(1, 2, 3) and the matrix c(-1, 0, 1)
# this means multiply 1 by -1, 2 by 0, and 3 by 1, and add up those products
oneway(dv = as.numeric(as.matrix(C14T8[, c(&quot;Angle0&quot;, &quot;Angle4&quot;, &quot;Angle8&quot;)]) %*% c(-1, 0, 1)), group = C14T8$Group, contrast = list(age = c(1, 1) / 2))</code></pre>
<pre><code>##   contrast   equal_var   est       se       t       df            p
## 1      age     Assumed 208.5 13.64734 15.2777 18.00000 9.479528e-12
## 2      age Not Assumed 208.5 13.64734 15.2777 17.66239 1.277400e-11
##        lwr      upr
## 1 179.8280 237.1720
## 2 179.7887 237.2113</code></pre>
</div>
<div id="test-angle-quadratic-effect-within-subjects" class="section level3">
<h3>Test angle quadratic effect (within-subjects)</h3>
<pre class="r"><code># c(1, 2, 3) %*% c(-1, 0, 1) means tke the dot product of the matrix c(1, 2, 3) and the matrix c(-1, 0, 1)
# this means multiply 1 by -1, 2 by 0, and 3 by 1, and add up those products
oneway(dv = as.numeric(as.matrix(C14T8[, c(&quot;Angle0&quot;, &quot;Angle4&quot;, &quot;Angle8&quot;)]) %*% c(1, -2, 1) / 3), group = C14T8$Group, contrast = list(age = c(1, 1) / 2))</code></pre>
<pre><code>##   contrast   equal_var  est       se         t       df         p
## 1      age     Assumed -3.5 6.220486 -0.562657 18.00000 0.5806094
## 2      age Not Assumed -3.5 6.220486 -0.562657 17.01589 0.5810066
##         lwr      upr
## 1 -16.56876 9.568756
## 2 -16.62314 9.623144</code></pre>
</div>
<div id="test-angle-linear-effect-x-age-effect-mixed" class="section level3">
<h3>Test angle linear effect x age effect (mixed)</h3>
<pre class="r"><code># c(1, 2, 3) %*% c(-1, 0, 1) means tke the dot product of the matrix c(1, 2, 3) and the matrix c(-1, 0, 1)
# this means multiply 1 by -1, 2 by 0, and 3 by 1, and add up those products
oneway(dv = as.numeric(as.matrix(C14T8[, c(&quot;Angle0&quot;, &quot;Angle4&quot;, &quot;Angle8&quot;)]) %*% c(-1, 0, 1)), group = C14T8$Group, contrast = list(age = c(-1, 1)))</code></pre>
<pre><code>##   contrast   equal_var est       se       t       df           p      lwr
## 1      age     Assumed  81 27.29469 2.96761 18.00000 0.008245640 23.65599
## 2      age Not Assumed  81 27.29469 2.96761 17.66239 0.008369684 23.57732
##        upr
## 1 138.3440
## 2 138.4227</code></pre>
</div>
<div id="test-angle-quadratic-effect-x-age-effect-mixed" class="section level3">
<h3>Test angle quadratic effect x age effect (mixed)</h3>
<pre class="r"><code># c(1, 2, 3) %*% c(-1, 0, 1) means tke the dot product of the matrix c(1, 2, 3) and the matrix c(-1, 0, 1)
# this means multiply 1 by -1, 2 by 0, and 3 by 1, and add up those products
oneway(dv = as.numeric(as.matrix(C14T8[, c(&quot;Angle0&quot;, &quot;Angle4&quot;, &quot;Angle8&quot;)]) %*% c(1, -2, 1) / 3), group = C14T8$Group, contrast = list(age = c(-1, 1)))</code></pre>
<pre><code>##   contrast   equal_var est       se        t       df          p       lwr
## 1      age     Assumed  25 12.44097 2.009489 18.00000 0.05972078 -1.137512
## 2      age Not Assumed  25 12.44097 2.009489 17.01589 0.06061833 -1.246289
##        upr
## 1 51.13751
## 2 51.24629</code></pre>
</div>
<div id="test-angle-by-age-effects-via-linear-mixed-effects-model" class="section level3">
<h3>Test angle by age effects via linear mixed effects model</h3>
<pre class="r"><code># fit model
lmer3 &lt;- lmer(rt ~ (angle_linear + angle_quadratic) * age + (1 + angle_linear + angle_quadratic | subj), data = lC14T8, REML = TRUE, control = lmerControl(check.nobs.vs.nRE = &quot;ignore&quot;, check.nobs.vs.nlev = &quot;ignore&quot;))

# diagnostics
plot(lmer3)</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<pre class="r"><code>qqmath(ranef(lmer3, condVar = TRUE))</code></pre>
<pre><code>## $subj</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-25-2.png" width="672" /></p>
<pre class="r"><code>qqmath(lmer3)</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-25-3.png" width="672" /></p>
<pre class="r"><code>dotplot(ranef(lmer3, condVar = TRUE))</code></pre>
<pre><code>## $subj</code></pre>
<p><img src="/post/nrg05/nrg05_files/figure-html/unnamed-chunk-25-4.png" width="672" /></p>
<pre class="r"><code># results
summary(lmer2)</code></pre>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: response ~ treatment * sequence + (1 + sequence | id)
##    Data: lmydata
## Control: 
## lmerControl(check.nobs.vs.nlev = &quot;ignore&quot;, check.nobs.vs.nRE = &quot;ignore&quot;)
## 
## REML criterion at convergence: 290.1
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.71150 -0.45806 -0.00089  0.43872  1.58043 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  id       (Intercept) 0.5068   0.7119       
##           sequence    0.5947   0.7711   0.52
##  Residual             0.4903   0.7002       
## Number of obs: 100, groups:  id, 50
## 
## Fixed effects:
##                    Estimate Std. Error      df t value Pr(&gt;|t|)    
## (Intercept)          4.1696     0.1226 47.9928  34.001  &lt; 2e-16 ***
## treatment            1.2661     0.2453 47.9928   5.162 4.63e-06 ***
## sequence            -0.6835     0.1775 48.0030  -3.851 0.000348 ***
## treatment:sequence   0.8483     0.3550 48.0030   2.390 0.020839 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) trtmnt sequnc
## treatment   0.000               
## sequence    0.261  0.000        
## trtmnt:sqnc 0.000  0.261  0.000 
## convergence code: 0
## unable to evaluate scaled gradient
## Model failed to converge: degenerate  Hessian with 1 negative eigenvalues</code></pre>
</div>
</div>
</div>
<div id="export-data-for-use-in-spss" class="section level1">
<h1>Export data for use in SPSS</h1>
<pre class="r"><code>write_csv(lC14T8, path = &quot;lC14T8.csv&quot;)</code></pre>
</div>
<div id="resources" class="section level1">
<h1>Resources</h1>
<blockquote>
<ul>
<li>Boik, R. J. (1981). A priori tests in repeated measures designs: Effects of nonsphericity. <em>Psychometrika, 46</em>(3), 241-255.<br />
</li>
<li>Maxwell, S. E., Delaney, H. D., &amp; Kelley, K. (2018). <em>Designing experiments and analyzing data: A model comparison perspective</em> (3rd ed.). Routledge.<br />
</li>
<li><a href="https://designingexperiments.com/">DESIGNING EXPERIMENTS AND ANALYZING DATA</a> includes computer code for analyses from their book, Shiny apps, and more.</li>
</ul>
</blockquote>
</div>
<div id="general-word-of-caution" class="section level1">
<h1>General word of caution</h1>
<blockquote>
<p>Above, I listed resources prepared by experts on these and related topics. Although I generally do my best to write accurate posts, don’t assume my posts are 100% accurate or that they apply to your data or research questions. Trust statistics and methodology experts, not blog posts.</p>
</blockquote>
</div>
