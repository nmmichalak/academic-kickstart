---
title: Using Principal Components or Common Factor Analysis in Social Psychology
author: Nick Michalak
date: '2019-02-14'
slug: using-principal-components-or-common-factor-analysis-in-social-psychology
categories:
  - common factor analysis
  - tutorial
  - principal components analysis
  - R
  - measurement
  - demonstration
  - reliability
tags:
  - common factor analysis
  - tutorial
  - principal component analysis
  - R
  - measurement
  - reliability
  - demonstration
image:
  caption: ''
  focal_point: ''
output: 
  html_document: 
    fig_height: 7.5
    fig_width: 10.5
---

Note. I'm not done with this post but it's fun to build a new website and see your posts appear so pretty online ... so here it is!

# Multidimensional Scaling

## Install packages and/or load libraries

```{r, warning = FALSE, message = FALSE}

# install.packages("tidyverse")
# install.packages("knitr")
# install.packages("haven")
# install.packages("maps")
# install.packages("psych")

library(tidyverse)
library(knitr)
library(haven)
library(maps)
library(psych)

```

## Data
> help("UScitiesD")  
> UScitiesD gives “straight line” distances between 10 cities in the US.

```{r}

UScitiesD %>% 
  as.matrix() %>% 
  as.data.frame() %>% 
  kable()

```

### distance matrix represented with colors

```{r}

UScitiesD %>% 
  as.matrix() %>% 
  as.data.frame() %>% 
  rownames_to_column() %>%
  rename(city1 = rowname) %>% 
  gather(key = city2, value = distance, -city1) %>% 
  ggplot(mapping = aes(x = city1, y = city2, fill = distance, label = distance)) +
  geom_tile() +
  geom_text() +
  scale_fill_gradient2() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

### non-Metric Multidimensional Scaling (2-dimensions, like a map)

```{r}

cmdscale.fit1 <- cmdscale(UScitiesD, k = 2, eig = TRUE)

```

### plot eigenvalues sorted by size (i.e., screeplot)
> look for the "elbow"

```{r}

tibble(index = 1:length(cmdscale.fit1$eig),
       eigenvalue = cmdscale.fit1$eig) %>% 
  ggplot(mapping = aes(x = index, y = eigenvalue)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(labels = scales::comma)

```

### store points from fitted configuration

```{r}

cmdscale.data <- as_tibble(cmdscale.fit1$points) %>% 
  mutate(city = rownames(cmdscale.fit1$points))

```

#### plot

```{r}

cmdscale.data %>% 
  ggplot(mapping = aes(x = V2, y = V1, label = city)) +
  geom_point() +
  geom_label(nudge_y = 100)

```

#### compare

```{r}

map_data("state") %>% 
  ggplot(mapping = aes(x = long, y = lat, group = group)) +
  geom_polygon(fill = "white", colour = "black") +
  coord_quickmap()

```

# Measuring variables we can't observe
> 

# Partitioning variance

## Common Variance

### Communality

## Unique Variance

### Specific Variance

### Error Variance

# SPSS Anxiety Questionnaire (SAQ)

## Description

### Read SPSS Anxiety Questionnaire data
> You can download these data [[**SAQ.sav**](https://github.com/nmmichalak/academic-kickstart/raw/master/static/post/2019-02-14-using-principal-components-or-common-factor-analysis-in-social-psychology/2019-02-14-using-principal-components-or-common-factor-analysis-in-social-psychology_files/data/SAQ.sav)]

```{r, warning = FALSE, message = FALSE}

saq <- read_spss(file = "data/SAQ.sav")

```

### Correlation matrix

```{r}

saq %>% 
  cor(use = "pairwise.complete.obs") %>% 
  round(2) %>% 
  as.data.frame() %>% 
  rownames_to_column() %>%
  rename(item1 = rowname) %>% 
  gather(key = item2, value = r, -item1) %>% 
  ggplot(mapping = aes(x = item1, y = item2, fill = r, label = r)) +
  geom_tile() +
  geom_text() +
  scale_fill_gradient2() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

### Histograms

```{r}

saq %>% 
  gather(key = variable, value = response) %>% 
  ggplot(mapping = aes(x = response)) +
  geom_histogram(binwidth = 1, color = "white") +
  facet_wrap(facets = ~ variable)

```

### Parallel Analysis

```{r}

fa.parallel(saq, fm = "minres", fa = "both")

```

# Principal Components Analysis

## all items

```{r}

principal(saq, rotate = "varimax") %>% 
  print(sort = TRUE)

# plot
principal(saq, rotate = "varimax") %>% 
  fa.diagram(sort = TRUE)

```

## 4 components

```{r}

principal(saq, nfactors = 4, rotate = "varimax") %>% 
  print(sort = TRUE)

# plot
principal(saq, nfactors = 4, rotate = "varimax") %>% 
  fa.diagram(sort = TRUE)

```

# Common Factor Analysis

## all items

```{r}

fa(saq, fm = "minres", rotate = "oblimin") %>% 
  print(sort = TRUE)

# plot
fa(saq, fm = "minres", rotate = "oblimin") %>% 
  fa.diagram(sort = TRUE)

```

## 6 factors

```{r}

fa(saq, nfactors = 6, fm = "minres", rotate = "oblimin") %>% 
  print(sort = TRUE)

# plot
fa(saq, nfactors = 6, fm = "minres", rotate = "oblimin") %>% 
  fa.diagram(sort = TRUE)

```

# General word of caution
> Above, I listed resources prepared by experts on these and related topics. Although I generally do my best to write accurate posts, don't assume my posts are 100% accurate or that they apply to your data or research questions. Trust statistics and methodology experts, not blog posts.
